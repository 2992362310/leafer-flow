# 连接器插件设计

- 基于 `@leafer-in/editor` 实现

1 内部维护 connectors, 数据结构为 Map, key 为 节点 id, value 为连接线的 ids(`节点 id 和 连线 ids 为一对多`)

2 暴露添加连接器接口, 当开始添加连接器时，查找是否已有节点

2.1 若没有，则在 connectors 添加节点 id, value 为空数组, 在数组添加连线 id

2.2 若有，则查找节点 id 对应的数组，添加连线 id

3 在构造函数中，添加 editor 的 resize 和 move 事件监听，当节点改变时，更新连线

4 连线方式, 首先获取节点的边缘，根据连线方式，生成节点的连接点

4.1 直连，若鼠标在节点边缘附近一定范围内，则在离数据最近的节点边缘生成连接点，更新连接线

4.2 直连，若鼠标在节点内，获取节点中心点和连线起点所产生的直线，与节点边缘相交的点作为连接点，更新连接线

5 边缘连接时，连接器内部维护一个节点的边框（线宽可动态调整，默认为8），，在画布上显示，当松开鼠标更新完连线后，移除并销毁边框

6 暴露删除连接器接口，开始编辑时，检查鼠标所在位置的元素节点，检查对应节点是否有连接器

6.1 若有，则检查连接器是否有所在位置的连线，当移动对应连线的终点时，若新连线不满足连接的条件，则删除该连接器，若满足连接条件，则更新连线

6.2 若没有，则检查鼠标所在位置的元素节点，检查对应节点是否有连接器，若没有，则添加连接器

7 内部维护 lianes, 数据结构为 Set, key 为 连线 id, value 为 节点 id (`连线 id 和 节点 id 为一对一`)

7.1 在 2.1 的基础上，更新 lianes 数据，新增对应的 连线id

7.2 在6.1 的基础上，更新 lianes 数据， 删除对应的 连线id

# 总接

1 节点拖拽时，检查鼠标所在位置的元素节点id，检查对应节点是否有connector，若有，则进行相关动作

2 连线拖拽时，检查鼠标所在位置的连线di，检查对应节点是否有 liane，若有，则进行相关动作
